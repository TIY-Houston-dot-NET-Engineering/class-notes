# 11-1-2016

## ASP.NET MVC Controller Review

A route can return a view, or a status message with data

```c#
return View("~/Path/to/view");
return View("~/Path/to/view", new Post); // with a ViewModel
return View(new Post); // just a ViewModel, defaults to Views/ControllerName/ActionName.cshtml
return Ok("ok."); // 200 OK - JSON response
return Ok(new { some="data", can="be sent here" }); // 200 OK - JSON response
```

A route can take arguments and save to the db (via repository)

```c#
[HttpPost("{id?}")]
[HttpPut("/update/{id}")]
public IActionResult Create([FromBody] Post p, [FromForm] Post other, int id){
    postRepo.Create(p); // a Repo<T> should be responsible for saving to the DB
    return Ok(p);
}

/**
    Other attributes for Model Binding
    [BindRequired]: This attribute adds a model state error if binding cannot occur.
    [BindNever]: Tells the model binder to never bind to this parameter.
    [FromHeader], [FromQuery], [FromRoute], [FromForm]: Use these to specify the exact binding source you want to apply.
    [FromServices]: This attribute uses dependency injection to bind parameters from services.
    [FromBody]: Use the configured formatters to bind data from the request body. The formatter is selected based on content type of the request.
    [ModelBinder]: Used to override the default model binder, binding source and name.
**/
```

Each Route will respond to all HTTP Verbs unless you explicitly use a particular attribute for the verb you want:

```c#
[HttpPost] / [HttpPost("sub/route/{id}")]
[HttpGet] / [HttpGet("sub/route/{id}")]
[HttpPut] / [HttpPut("sub/route/other/route")]
[HttpDelete] / etc
```

A Controller can define a root route, too! Then your route methods can define the subroute:

```c#
[Route("/mycontroller")]
class MyController : Controller {
    [HttpGet("{id?}")]
    public IActionResult Get(int? id){
        // ...
    }
}
```

Each Route that handles Post/Put data may also need some extra security measures:

```c#
[ValidateAntiForgeryToken]
```

Route methods can be async:

```c#
public async Task<IActionResult> GetPosts(...){
    var posts = await GetPostsFromDB();
}
```

Views have a few instance properties inherited from the ASP.NET MVC Controller class:

```c#
public IActionResult Index(){
    ViewData                // Dictionary<string, string> that is accessible inside View()s
    ModelState              // contains the model instance being passed into the route (auto-parsed by MVC), has properties like ModelState.IsValid
    RedirectToLocal(url)    // redirect a client to a different url on the server
    AddErrors(...)          // build up errors to send
}
```
